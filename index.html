<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>Player de Vídeos com Crossfade e Preload</title>
<style>
  body, html {
    margin: 0; padding: 0;
    height: 100vh;
    background: #000;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  #container {
    position: relative;
    width: 80vw;
    max-width: 1280px;
    aspect-ratio: 16 / 9;
  }
  video {
    position: absolute;
    top: 0; left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover; /* preenche toda a área */
    background: black;
    transition: opacity 1s ease;
    opacity: 0;
    pointer-events: none;
  }
  video.active {
    opacity: 1;
    pointer-events: auto;
  }
</style>
</head>
<body>

<div id="container">
  <video id="video1" muted playsinline></video>
  <video id="video2" muted playsinline></video>
</div>

<script>
  const videos = [
    "https://raw.githubusercontent.com/haddycavalcante/dooh-player/main/A%20quinta%20onda%20de%20frio%20do%20ano%20vai%20deixar%20os%20pr%C3%B3ximos%20dias%20bastante%20gelad.mp4",
    "https://raw.githubusercontent.com/haddycavalcante/dooh-player/main/E%20eu%20n%C3%A3o%20sou%20nadinha%20diferente.mp4"
  ];

  const video1 = document.getElementById('video1');
  const video2 = document.getElementById('video2');

  let currentIndex = 0;
  let currentVideo = video1;
  let nextVideo = video2;

  function playWithPreload(videoElem, src) {
    return new Promise((resolve) => {
      videoElem.src = src;
      videoElem.load();
      videoElem.oncanplaythrough = () => {
        videoElem.play();
        resolve();
      };
      // Em caso de erro, tenta tocar mesmo assim para evitar travar
      videoElem.onerror = () => {
        videoElem.play();
        resolve();
      };
    });
  }

  async function start() {
    currentVideo.classList.add('active');
    await playWithPreload(currentVideo, videos[currentIndex]);
  }

  async function next() {
    currentIndex = (currentIndex + 1) % videos.length;

    nextVideo.classList.add('active');
    await playWithPreload(nextVideo, videos[currentIndex]);

    currentVideo.classList.remove('active');
    currentVideo.pause();

    // troca referências dos vídeos para próxima troca
    let temp = currentVideo;
    currentVideo = nextVideo;
    nextVideo = temp;

    // adiciona listener para quando o novo vídeo acabar, chamar next()
    currentVideo.onended = next;
  }

  // adiciona listener para o primeiro vídeo acabar
  currentVideo.onended = next;

  // inicia player
  start();
</script>

</body>
</html>
