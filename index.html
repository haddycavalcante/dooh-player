<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Flight Animation Globe</title>
<style>
  body, html {
    margin: 0;
    padding: 0;
    background: #000;
    overflow: hidden;
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  #globeCanvas {
    width: 80vw;
    height: 45vw; /* 16:9 */
    max-width: 1200px;
    max-height: 675px;
    background: #000;
  }
  .tooltip {
    position: absolute;
    color: white;
    font-family: Arial, sans-serif;
    font-size: 16px;
    pointer-events: none;
    white-space: nowrap;
  }
</style>
</head>
<body>
<canvas id="globeCanvas"></canvas>
<script src="https://unpkg.com/three@0.152.2/build/three.min.js"></script>
<script src="https://unpkg.com/three-globe"></script>

<script>
// === Scene Setup ===
const canvas = document.getElementById('globeCanvas');
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(40, canvas.clientWidth / canvas.clientHeight, 0.1, 2000);
camera.position.z = 400;

const renderer = new THREE.WebGLRenderer({canvas, antialias: true, alpha: true});
renderer.setSize(canvas.clientWidth, canvas.clientHeight);

// === Globe Setup ===
const Globe = new ThreeGlobe()
  .globeImageUrl('https://unpkg.com/three-globe/example/img/earth-blue-marble.jpg')
  .bumpImageUrl('https://unpkg.com/three-globe/example/img/earth-topology.png')
  .arcsData([
    { startLat: -1.455, startLng: -48.503, endLat: -26.5225, endLng: 31.4659 },
    { startLat: -26.5225, startLng: 31.4659, endLat: -30.5595, endLng: 22.9375 }
  ])
  .arcColor('color')
  .arcDashLength(0.4)
  .arcDashGap(4)
  .arcDashInitialGap(() => Math.random() * 5)
  .arcDashAnimateTime(4000)
  .arcStroke(1.5);

scene.add(Globe);

// === Lights ===
scene.add(new THREE.AmbientLight(0xffffff, 0.7));
const dirLight = new THREE.DirectionalLight(0xffffff, 0.6);
dirLight.position.set(5,3,5);
scene.add(dirLight);

// === Labels ===
const labels = [
  { name: 'BELÃ‰M / BRAZIL', lat: -1.455, lng: -48.503 },
  { name: 'ESWATINI', lat: -26.5225, lng: 31.4659 },
  { name: 'SOUTH AFRICA', lat: -30.5595, lng: 22.9375 }
];

const labelDivs = labels.map(l => {
  const div = document.createElement('div');
  div.className = 'tooltip';
  div.innerText = l.name;
  document.body.appendChild(div);
  return {div, lat: l.lat, lng: l.lng};
});

function latLngToVector3(lat, lng, radius) {
  const phi = (90 - lat) * (Math.PI / 180);
  const theta = (lng + 180) * (Math.PI / 180);
  const x = -radius * Math.sin(phi) * Math.cos(theta);
  const y = radius * Math.cos(phi);
  const z = radius * Math.sin(phi) * Math.sin(theta);
  return new THREE.Vector3(x, y, z);
}

function updateLabels() {
  const vector = new THREE.Vector3();
  labelDivs.forEach(l => {
    vector.copy(latLngToVector3(l.lat, l.lng, Globe.globeRadius + 5)); // +5 para ficar fora do globo
    vector.project(camera);
    const x = (vector.x * 0.5 + 0.5) * canvas.clientWidth;
    const y = (-vector.y * 0.5 + 0.5) * canvas.clientHeight;
    l.div.style.transform = `translate(-50%, -50%) translate(${x}px,${y}px)`;
  });
}

// === Animate ===
function animate() {
  requestAnimationFrame(animate);
  Globe.rotation.y += 0.001;
  updateLabels();
  renderer.render(scene, camera);
}

animate();

// === Resize ===
window.addEventListener('resize', () => {
  camera.aspect = canvas.clientWidth / canvas.clientHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(canvas.clientWidth, canvas.clientHeight);
});
</script>
</body>
</html>
